!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).UMap={})}(this,function(e){"use strict";function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=h(r);return e=n?(e=h(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?w(t):e}}function p(e,t,r){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(r):t.value}})(e,t,r||e)}function a(e,t){for(var r=0,n=Array(t=null==t||t>e.length?e.length:t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function _(e){return null!=e}var t=function(){function e(){m(this,e),this._array=[],this._hash={}}return s(e,[{key:"length",get:function(){return this._array.length}},{key:"values",get:function(){return this._array}},{key:"contains",value:function(e){if("string"!=typeof e&&"number"!=typeof e)throw"key is required to be a string or number.";return _(this._hash[e])}},{key:"set",value:function(e,t){if("string"!=typeof e&&"number"!=typeof e)throw"key is required to be a string or number.";t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._array.push(t))}},{key:"get",value:function(e){if("string"!=typeof e&&"number"!=typeof e)throw"key is required to be a string or number.";return this._hash[e]}},{key:"remove",value:function(e){if(_(e)&&"string"!=typeof e&&"number"!=typeof e)throw"key is required to be a string or number.";var t,r=this._hash[e],n=_(r);return n&&((t=this._array).splice(t.indexOf(r),1),delete this._hash[e]),n}},{key:"removeAll",value:function(){var e=this._array;0<e.length&&(this._hash={},e.length=0)}}]),e}();function g(e,t){return null!=e?e:t}function f(e,t,r){r=g(r,!1);var n,o,i,s={},a=_(e),u=_(t);if(a)for(n in e)e.hasOwnProperty(n)&&(o=e[n],u&&r&&"object"===l(o)&&t.hasOwnProperty(n)&&"object"===l(i=t[n])?s[n]=f(o,i,r):s[n]=o);if(u)for(n in t)t.hasOwnProperty(n)&&!s.hasOwnProperty(n)&&(s[n]=i=t[n]);return s}g.EMPTY_OBJECT=Object.freeze({});var u={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4,SphereMetricOptions:{projection:"EPSG:4326",radius:6378137}};function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function k(e,t,r){m(this,k),this.type=e,this.feature=t,this.verticesFeature=r}k.DRAW_START=Object.freeze("draw_start"),k.DRAW_END=Object.freeze("draw_end"),k.MOVEING=Object.freeze("draw_move"),k.DRAWING=Object.freeze("drawing"),k.MODIFY_START=Object.freeze("modify_one_feature_start"),k.MODIFY_END=Object.freeze("modify_one_feature");var d=function(){i(y,ol.Map);var d=c(y);function y(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.showBaseZoomBar,n=void 0!==r&&r,o=t.showScaleBar,i=void 0===o||o,s=t.showMousePosition,a=void 0===s||s,u=t.center,l=void 0===u?[0,0]:u,h=t.zoom,r=void 0===h?5:h,o=t.minZoom,s=void 0===o?0:o,u=t.maxZoom,h=void 0===u?22:u,o=t.projection,u=void 0===o?new ol.proj.Projection({code:"EPSG:4326",units:"degrees",axisOrientation:"neu"}):o,o=t.loadTilesWhileAnimating,o=void 0===o||o,t=t.loadTilesWhileInteracting,t=void 0===t||t;m(this,y);var c,h={controls:ol.control.defaults({attribution:!1,zoom:n}),interactions:ol.interaction.defaults({keyboard:!1,doubleClickZoom:!1}),target:e,loadTilesWhileInteracting:t,loadTilesWhileAnimating:o,view:new ol.View({projection:u,center:l,zoom:r,minZoom:s,maxZoom:h})};(c=d.call(this,h)).scaleLine=new ol.control.ScaleLine,i&&c.addControl(c.scaleLine),c.mousePositionControl=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:u,undefinedHTML:"&nbsp;"}),a&&c.addControl(c.mousePositionControl);a=function(e,t,r){var n=arguments,o=document.createElement("div");o.className="ol-popup";var i=document.createElement("a");i.href="#",i.className="ol-popup-closer",o.appendChild(i);var s=document.createElement("div");return s.id=e,o.appendChild(s),i.onclick=function(){return t&&r&&t.apply(r,n),i.blur(),!1},o}("ol_popup_html_content",c.closePopup,w(c));c._htmlPopup=c.createOverlayer(a),c._htmlPopup.setPosition(void 0),c.addOverlay(c._htmlPopup),c.map_=w(c);for(var p=c.getInteractions(),g=0,f=p.getLength();g<f;g++){var v=p.item(g);v instanceof ol.interaction.DoubleClickZoom?c.dbClickZoom=v:v instanceof ol.interaction.MouseWheelZoom?c.mouseWheelZoom=v:v instanceof ol.interaction.KeyboardPan&&(c.keyboardPan=v)}return c}return s(y,[{key:"view",get:function(){return this.getView()}},{key:"zoom",get:function(){return this.view.getZoom()},set:function(e){this.view.setZoom(parseFloat(e))}},{key:"center",get:function(){return this.view.getCenter()},set:function(e){this.view.setCenter(e.map(function(e){return parseFloat(e)}))}},{key:"removeLisenter",value:function(e){e&&(ol.Observable.unByKey(e),e=null)}},{key:"pick",value:function(r,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(null!==r||"function"==typeof r){var o=this,i=function(){return!0};t&&t instanceof Array&&(i=function(e){return!!~t.indexOf(e)});return o.on("click",function(e){n&&e.preventDefault();var t=[];o.forEachFeatureAtPixel(e.pixel,function(e){t.push(e)},{layerFilter:i,hitTolerance:6}),r(e.coordinate,t)})}}},{key:"shieldKeyboardPan",value:function(e){_(this.keyboardPan)&&(e?this.addInteraction(this.keyboardPan):this.removeInteraction(this.keyboardPan))}},{key:"showLngLatTip",value:function(e){var t=this.mousePositionControl.element;t.style.display=e?"":"none"}},{key:"createOverlayer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{autoPan:!0,positioning:"bottom-center",stopEvent:!0,autoPanAnimation:{duration:250}};return t.element=e,new ol.Overlay(t)}},{key:"closePopup",value:function(){_(this._htmlPopup)&&this._htmlPopup.setPosition(void 0)}},{key:"showPopup",value:function(e,t){_(t)?(_(this._popupContent)||(this._popupContent=document.getElementById("ol_popup_html_content")),this._popupContent.innerHTML="",this._popupContent.innerHTML=t,this._htmlPopup.setPosition(e)):this._htmlPopup.setPosition(void 0)}},{key:"centerAndZoom",value:function(e,t){_(e)&&(this.center=[parseFloat(e[0]),parseFloat(e[1])]),_(t)&&(this.zoom=t)}},{key:"getExtent",value:function(){var e=this.getSize();return this.view.calculateExtent(e)}},{key:"modify",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length?arguments[2]:void 0;if(_(e)){e instanceof Array&&(e=new ol.Collection(e));var o={};r||(o.insertVertexCondition=function(){return!e.getArray().every(function(e){return e.getGeometry().getType().match(/Polygon/)})}),o.features=e;var i=new ol.interaction.Modify(o),s=[],a=i.on("modifyend",function(e){e=e.features.item(e.features.getLength()-1);~s.indexOf(e)||s.push(e)});return this.once(k.MODIFY_END,function(){t.removeLisenter(a),t.removeInteraction(i),i=null,n&&n(s)}),this.addInteraction(i),i}}},{key:"closeModify",value:function(){this.dispatchEvent({type:k.MODIFY_END})}},{key:"panTo",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;this.center=[parseFloat(e[0]),parseFloat(e[1])],Math.abs(e[0]-this.center[0])<t||(this.zoom=5)}},{key:"fitLayer",value:function(e){var t,r;e instanceof ol.layer.Vector&&((t=(r=e.getSource()).getFeatures().length)<1||(e=r.getFeatures()[0].getGeometry(),1===t&&e instanceof ol.geom.Point?this.center=e.getCoordinates():(r=r.getExtent(),this.view.fit(r))))}},{key:"setMapSize",value:function(e,t){var r=this.getTarget(),r=document.getElementById(r);r.style.height=t+"px",r.style.width=e+"px",this.updateSize()}}]),y}();function y(e){return"[object String]"===Object.prototype.toString.call(e)}var P=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.headHeightFacto,n=t.headWidthFactor,o=void 0===n?.5:n,i=t.neckHeightFactor,s=void 0===i?.8:i,a=t.neckWidthFactor,u=void 0===a?.2:a,l=t.tailWidthFactor,n=void 0===l?.1:l,i=t.hasSwallowTail,a=void 0===i||i,l=t.swallowTailFactor,i=void 0===l?.5:l,l=t.curveFitMethod,l=void 0===l?"useBSplieFit":l,t=t.maxVertices,t=void 0===t?-1:t;m(this,e),this.headHeightFactor=void 0===r?.2:r,this.headWidthFactor=o,this.neckHeightFactor=s,this.neckWidthFactor=u,this.tailWidthFactor=n,this.hasSwallowTail=a,this.swallowTailFactor=i,this.curveFitMethod=l,this.maxVertices=t},M=function(e){var t,r=arguments.length<=1||void 0===arguments[1]||arguments[1],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=r?"?":"";for(t in e)e.hasOwnProperty(t)&&_(e[t])&&(o+=t+"="+e[t]+"&");return n?o+=1e4*Math.random():o.slice(0,-1)};function b(e,t){var r,n=e[0],o=e[1];return e=r=n,o=n=o,(t=t)?(t[0]=r,t[1]=n,t[2]=e,t[3]=o,t):[r,n,e,o]}var S={isString:y,throttle:function(n,o){var i,s=null;return function(){var e=this,t=arguments,r=+new Date;i&&r<i+o?(clearTimeout(s),s=setTimeout(function(){i=r,n.apply(e,t)},o)):(i=r,n.apply(e,t))}}},F={Ellipse:"ellipse",Sector:"sector",Circle:"circle",Polyline:"polyline",Freehand_line:"freehandline",Polygon:"polygon",Freehand_Polygon:"freehandpolygon",Rect:"rect",Marker:"point",Point:"point",ArrowCross:"arrowcross",CircleClosedangle:"circleclosedangle",Closedangle:"closedangle",DoubleClosedangle:"doubleclosedangle",Fourstar:"fourstar",Rhombus:"rhombus",SameDirectionClosedangle:"samedirectionclosedangle",Triangle:"triangle",Vane:"vane",SimpleArrow:"simplearrow",DoubleArrow:"doublearrow",StraightArrow:"straightarrow",SingleLineArrow:"singlelinearrow",TriangleFlag:"triangleflag",RectFlag:"rectflag",CurveFlag:"curveflag",CustomArea:"assemblyarea",Curve:"bezierline"};function x(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function C(e){for(var t=0,r=0;r<e.length-1;r++)t+=x(e[r],e[r+1]);return t}function I(e,t){var r=Math.asin(Math.abs(t[0]-e[0])/x(e,t));return t[1]<e[1]||t[0]<e[0]?e[1]<=t[1]&&t[0]<e[0]?2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?r+Math.PI:t[1]<e[1]&&e[0]<=t[0]?Math.PI-r:void 0:r}function T(e,t,r,n){e=I(t,e),r=arguments.length<=4||void 0===arguments[4]||arguments[4]?e-r:e+r;return[t[0]+n*Math.sin(r),t[1]+n*Math.cos(r)]}function A(e,t,r){r=I(t,e)-I(t,r);return r<0?r+2*Math.PI:r}function E(e){if(e<=1)return 1;if(2===e)return 2;if(3===e)return 6;if(4===e)return 24;if(5===e)return 120;for(var t=1,r=1;r<=e;r++)t*=r;return t}function O(e,t){return E(e)/E(t)/E(e-t)}function L(e,t,r){if(2===t)return i=r,0===(n=e)?Math.pow(i-1,2)/2:1===n?(-2*Math.pow(i,2)+2*i+1)/2:2===n?Math.pow(i,2)/2:0;for(var n,o=0,i=E(t),s=0;s<=t-e;s++)o+=(s%2==0?1:-1)*O(t+1,s)*Math.pow(r+t-e-s,t);return o/i}function R(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function G(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.01;if(e.length<=2)return e;(1<t||t<0)&&(t=.01);for(var r=[],n=e.length-1,o=0;o<=1;o+=t){for(var i=0,s=0,a=0;a<=n;a++){var u=O(n,a),l=Math.pow(o,a),h=Math.pow(1-o,n-a);i+=u*l*h*e[a][0],s+=u*l*h*e[a][1]}r.push([i,s])}return r.push(e[n]),r}function D(e,t){if(e.length<=2||e.length<=t)return e;var r=[],n=e.length-t-1;r.push(e[0]);for(var o=0;o<=n;o++)for(var i=0;i<=1;i+=.05){for(var s=0,a=0,u=0;u<=t;u++){var l=L(u,t,i);s+=l*e[o+u][0],a+=l*e[o+u][1]}r.push([s,a])}return r.push(e[e.length-1]),r}function N(e,t,r){return(t[1]-e[1])*(r[0]-e[0])<(r[1]-e[1])*(t[0]-e[0])}function z(e,t,r,n,o,i){var o=arguments.length<=4||void 0===o||o,s=5<arguments.length&&void 0!==i?i:100,a=[];o&&a.push(e);for(var u=(u=n-r)<0?u+2*Math.PI:u,l=0;l<=s;l++){var h=r+u*l/s;a.push([e[0]+t*Math.sin(h),e[1]+t*Math.cos(h)])}return a}function j(e){return("string"==typeof e?parseFloat(e):e)/180*Math.PI}function $(e,t,r){return[e[0]+t*Math.cos(r),e[1]+t*Math.sin(r)]}function V(e,t,r,n,o){var i,s,a=W(t,r,n),u=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=a[0]/u,h=a[1]/u,c=x(t,r),a=x(r,n),r=(4<arguments.length&&void 0!==o?o:.01)<u?N(t,r,n)?(s=[r[0]-(i=e*c)*h,r[1]+i*l],[r[0]+(i=e*a)*h,r[1]-i*l]):(s=[r[0]+(i=e*c)*h,r[1]-i*l],[r[0]-(i=e*a)*h,r[1]+i*l]):(s=[r[0]+e*(t[0]-r[0]),r[1]+e*(t[1]-r[1])],[r[0]+e*(n[0]-r[0]),r[1]+e*(n[1]-r[1])]);return[s,r]}function W(e,t,r){var n=e[0]-t[0],o=e[1]-t[1],i=Math.sqrt(n*n+o*o),e=r[0]-t[0],r=r[1]-t[1],t=Math.sqrt(e*e+r*r);return[(n/=i)+(e/=t),(o/=i)+(r/=t)]}function B(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,n=[];return n[0]=e[0]+(t[0]-e[0])*(r=r>=1?1:r),n[1]=e[1]+(t[1]-e[1])*r,n}var Z={posSmoothing:function(e){for(var t=[],r=(r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100)||100,n=0;n<e.length-1;n++)for(var o=0;o<r;o++)t.push(B(e[n],e[n+1],o/r));return t},lerp:B,intersects:function(e,t){var r=e[0][0],n=e[0][1],o=e[1][0],i=e[1][1],s=t[0][1],a=t[1][0],t=((e=t[1][1])-s)*(o-r)-(a-(u=t[0][0]))*(i-n),e=(a-u)*(n-s)-(e-s)*(r-u),u=(o-r)*(n-s)-(i-n)*(r-u);return 0==t?null:(e/=t,t=u/t,e<0||1<e||t<0||1<t?null:[r+e*(o-r),n+e*(i-n)])},wholeDistance:C,getAzimuthAngle:I,isClockWise:N,getBezierPoints:G,getCurvePoints:function(e,t){for(var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,n=[function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.01,n=t[0],o=t[1],i=t[2],s=V(0,n,o,i)[0],a=W(n,o,i);{var u,l;n=r<Math.sqrt(a[0]*a[0]+a[1]*a[1])?(u=R(n,o),l=2/x(n,o),l=u[0]+((t=-l*(n[1]-u[1]))*t-(i=l*(n[0]-u[0]))*i)*(r=s[0]-u[0])+(a=2*t*i)*(s=s[1]-u[1]),u[1]+a*r+(i*i-t*t)*s):(l=n[0]+e*(o[0]-n[0]),n[1]+e*(o[1]-n[1]))}return[l,n]}(e,t)],o=0;o<t.length-2;o++)var i=V(e,t[o],t[o+1],t[o+2]),n=n.concat(i);var s=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.01,n=t.length,o=t[n-3],i=t[n-2],s=t[n-1],a=V(0,o,i,s)[1],u=W(o,i,s);{var l;s=r<Math.sqrt(u[0]*u[0]+u[1]*u[1])?(t=R(i,s),l=2/x(i,s),l=t[0]+((n=-l*(s[1]-t[1]))*n-(o=l*(s[0]-t[0]))*o)*(r=a[0]-t[0])+(u=2*n*o)*(a=a[1]-t[1]),t[1]+u*r+(o*o-n*n)*a):(l=s[0]+e*(i[0]-s[0]),s[1]+e*(i[1]-s[1]))}return[l,s]}(e,t);n.push(s);for(var a,u,l,h,c,p,g,f,v,d=[],y=0;y<t.length-1;y++){var m=t[y],w=t[y+1];d.push(m);for(var _=0;_<r;_++){var k=(v=f=g=p=c=void 0,c=1-(a=Math.max(Math.min(a=_/r,1),0)),[(v=(f=c*c)*c)*(u=m)[0]+3*f*a*(l=n[2*y])[0]+3*c*(p=a*a)*(h=n[2*y+1])[0]+(g=p*a)*(k=w)[0],v*u[1]+3*f*a*l[1]+3*c*p*h[1]+g*k[1]]);d.push(k)}d.push(w)}return d},getAngleOfThreePoints:A,getThirdPoint:T,distance:x},q={triangleflag:function(e){var t=[],r=e.length;{var n,o;r<2||X(e[r-1],e[r-2])||(e=R(n=e[0],r=[n[0],(o=e[1])[1]]),o=[o[0],e[1]],t.push(r),t.push(n),t.push(o),t.push(e),t.push(r))}return t},rectflag:function(e){var t=[],r=e.length;{var n,o,i;r<2||X(e[r-1],e[r-2])||(r=R(n=e[0],o=[n[0],(i=e[1])[1]]),e=[i[0],r[1]],i=[i[0],n[1]],t.push(o),t.push(n),t.push(i),t.push(e),t.push(r),t.push(o))}return t},curveflag:function(e){var t=[],r=e.length;if(2<=r&&!X(e[r-1],e[r-2])){var n=e[0],o=e[1],i=[n[0],o[1]],s=R(n,i),a=[o[0],s[1]],u=[o[0],n[1]],l=x(n,s)/2,h=x(n,u),c=T(u,n,0,h/4,!1),r=T(n,c,1.5*Math.PI,l,!0);c=T(u,n,0,h/4*3,!1);e=T(n,c,1.5*Math.PI,l,!1);c=T(a,s,0,h/4,!1);o=T(s,c,1.5*Math.PI,l,!0);c=T(a,s,0,h/4*3,!1);c=T(s,c,1.5*Math.PI,l,!1),l=[];l.push(n),l.push(r),l.push(e),l.push(u);var p=G(l),l=[];l.push(s),l.push(o),l.push(c),l.push(a);var g=G(l);t.push(s);for(var f=0;f<p.length;f++)t.push(p[f]);g.reverse();for(var v=0;v<g.length;v++)t.push(g[v]);t.shift(i),t.push(i)}return t}},U={arrowcross:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=[];n.push([e[0][0]+t/32*15,e[0][1]-r/16*1]),n.push([e[0][0]+t/32*15,e[0][1]]),n.push([e[0][0]+t/32*17,e[0][1]-r/16*1]),n.push([e[0][0]+t/32*17,e[0][1]]);var o=[];o.push([e[0][0],e[0][1]-r/32*15]),o.push([e[0][0]+t/128*3,e[0][1]-r/32*17]),o.push([e[0][0]+t/128*6,e[0][1]-r/32*15]),o.push([e[0][0]+t/128*9,e[0][1]-r/32*17]),o.push([e[0][0]+t/128*12,e[0][1]-r/32*15]);var i=[],s=[e[0][0]+t/16*15,e[0][1]-r/32*15],a=[e[0][0]+t/16*15,e[0][1]-r/32*17],u=[e[0][0]+t,e[0][1]-r/32*17],l=[e[0][0]+t/16*15,e[0][1]-r/2],h=[e[0][0]+t/50*48,e[0][1]-r/2];i.push([e[0][0]+t,e[0][1]-r/32*15]),i.push(s),i.push(l),i.push(h),i.push(l),i.push(a),i.push(u);var c=[e[0][0]+t/2,e[1][1]+r/32],p=[e[0][0]+t/2+t/32-2*t/32,e[1][1]+r/32+r/64],s=[e[0][0]+t/2,e[1][1]+r/32+r/32],h=[e[0][0]+t/2,e[1][1]+r/32-r/32],l=[e[0][0]+t/2+t/32,e[1][1]+r/32+r/64-r/32],a=[e[0][0]+t/2+t/32-t/16,e[1][1]+r/32+r/64-r/32],u=[];u.push([e[0][0]+t/2+t/32,e[1][1]+r/32+r/64]),u.push(s),u.push(p),u.push(c),u.push(l),u.push(h),u.push(a);h=D(u,2),a=[],u=[e[0][0]+t/2,e[0][1]-r/16*2];a.push(u),a.push([e[0][0]+t/32*18,e[0][1]-r/16*4]),a.push([e[0][0]+t/32*17,e[0][1]-r/16*4]),a.push([e[0][0]+t/32*17,e[0][1]-r/32*15]),a.push([e[0][0]+t/16*12,e[0][1]-r/32*15]),a.push([e[0][0]+t/16*12,e[0][1]-r/32*14]),a.push([e[0][0]+t/16*14,e[0][1]-r/2]),a.push([e[0][0]+t/16*12,e[0][1]-r/32*18]),a.push([e[0][0]+t/16*12,e[0][1]-r/32*17]),a.push([e[0][0]+t/32*17,e[0][1]-r/32*17]),a.push([e[0][0]+t/32*17,e[0][1]-r/16*12]),a.push([e[0][0]+t/32*18,e[0][1]-r/16*12]),a.push([e[0][0]+t/2,e[0][1]-r/16*14]),a.push([e[0][0]+t/32*14,e[0][1]-r/16*12]),a.push([e[0][0]+t/32*15,e[0][1]-r/16*12]),a.push([e[0][0]+t/32*15,e[0][1]-r/32*17]),a.push([e[0][0]+t/16*4,e[0][1]-r/32*17]),a.push([e[0][0]+t/16*4,e[0][1]-r/32*18]),a.push([e[0][0]+t/16*2,e[0][1]-r/2]),a.push([e[0][0]+t/16*4,e[0][1]-r/32*14]),a.push([e[0][0]+t/16*4,e[0][1]-r/32*15]),a.push([e[0][0]+t/32*15,e[0][1]-r/32*15]),a.push([e[0][0]+t/32*15,e[0][1]-r/16*4]),a.push([e[0][0]+t/32*14,e[0][1]-r/16*4]),a.push(u);for(var g=[],f=0;f<5;f++)g[f]=[];return g[0].push(n),g[1].push(o),g[2].push(i),g[3].push(h),g[4].push(a),g},circleclosedangle:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=[];n.push([e[0][0]+t/32*15,e[0][1]-r/16]),n.push([e[0][0]+t/32*15,e[0][1]]),n.push([e[0][0]+t/32*17,e[0][1]-r/16]),n.push([e[0][0]+t/32*17,e[0][1]]);var o=null,i=[];i.push(o=[e[0][0]+t/2,e[0][1]-r/16*2]),i.push([e[0][0]+t/64*15,e[0][1]-r]),i.push([e[0][0]+t/32*15,e[0][1]-r/32*28]),i.push([e[0][0]+t/32*17,e[0][1]-r/32*28]),i.push([e[0][0]+t/64*49,e[0][1]-r]),i.push(o);var s=null,o=[];s=[e[0][0]+t/2+r/20*9,e[0][1]-r/16*9],o.push([e[0][0]+t/2-r/20*9,e[0][1]-r/16*9]),o.push(s);var a=null,u=0,l=[],h=0;u=x(a=[e[0][0]+t/2,e[0][1]-r/16*9],[e[0][0]+t/2,e[0][1]-r/5*1]);for(;h<500;)l.push([a[0]+u*Math.sin(2*Math.PI*h/500),a[1]+u*Math.cos(2*Math.PI*h/500)]),++h;l.push(l[0]);for(var c=[],p=0;p<4;p++)c[p]=[];return c[0].push(n),c[1].push(o),c[2].push(l),c[3].push(i),c},closedangle:function(e){if(null===e||e.length<2)return null;var t=[],r=Math.abs(e[1][0]-e[0][0]),n=Math.abs(e[1][1]-e[0][1]);t.push([e[0][0]+r/2,e[0][1]]),t.push([e[0][0]+r,e[0][1]-n]),t.push([e[0][0]+r/2,e[0][1]-n/4*3]);var o=[];o.push([e[0][0]+r/2,e[0][1]]),o.push([e[0][0],e[0][1]-n]),o.push([e[0][0]+r/2,e[0][1]-n/4*3]);for(var i=[],s=0;s<2;s++)i[s]=[];return i[0].push(t),i[1].push(o),i},doubleclosedangle:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=[];n.push([e[0][0]+t/32*15,e[0][1]-r/16]),n.push([e[0][0]+t/32*15,e[0][1]]),n.push([e[0][0]+t/32*17,e[0][1]-r/16]),n.push([e[0][0]+t/32*17,e[0][1]]);var o=null,i=[];i.push(o=[e[0][0]+t/2,e[0][1]-r/16*2]),i.push([e[0][0],e[0][1]-r/10*7]),i.push([e[0][0]+t/32*13,e[0][1]-r/32*18]),i.push([e[0][0]+t/32*19,e[0][1]-r/32*18]),i.push([e[0][0]+t,e[0][1]-r/10*7]),i.push(o);var s=null,a=[];a.push(s=[e[0][0],e[0][1]-r/10*3]),a.push([e[0][0]+t/2,e[0][1]-r/8*7]),a.push([e[0][0]+t,e[0][1]-r/10*3]),a.push([e[0][0]+t/2,e[0][1]-r/10*7]),a.push(s);var u=[e[0][0]+t/2,e[1][1]+r/32],l=[e[0][0]+t/2+t/32-2*t/32,e[1][1]+r/32+r/64],h=[e[0][0]+t/2,e[1][1]+r/32+r/32],c=[e[0][0]+t/2,e[1][1]+r/32-r/32],p=[e[0][0]+t/2+t/32,e[1][1]+r/32+r/64-r/32],o=[e[0][0]+t/2+t/32-t/16,e[1][1]+r/32+r/64-r/32],s=[];s.push([e[0][0]+t/2+t/32,e[1][1]+r/32+r/64]),s.push(h),s.push(l),s.push(u),s.push(p),s.push(c),s.push(o);for(var s=D(s,2),g=[],f=0;f<4;f++)g[f]=[];return g[0].push(n),g[1].push(s),g[2].push(a),g[3].push(i),g},fourstar:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=null,o=null,i=null,s=null,a=[];a.push(n=[e[0][0]+t/2,e[0][1]]),a.push(o=[e[0][0]+t/2,e[0][1]-r]),a.push(i=[e[0][0]+t/8*3,e[0][1]-r/8*5]),a.push(s=[e[0][0]+t/8*5,e[0][1]-r/8*3]),a.push(n);var u=null,l=null,h=[];h.push(u=[e[0][0],e[0][1]-r/2]),h.push(l=[e[0][0]+t,e[0][1]-r/2]),h.push(s),h.push(i),h.push(u);var c=null,s=null,i=[];i.push(u),i.push(l),i.push(c=[e[0][0]+t/8*5,e[0][1]-r/8*5]),i.push(s=[e[0][0]+t/8*3,e[0][1]-r/8*3]),i.push(u);u=[];u.push(n),u.push(o),u.push(c),u.push(s);for(var p=[],g=0;g<4;g++)p[g]=[];return p[0].push(a),p[1].push(h),p[2].push(i),p[3].push(u),p},rhombus:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=null,o=null,i=null,s=null,a=[],u=[],l=[];a.push(n=[e[0][0]+t/2,e[0][1]-r/16*2]),a.push(o=[e[0][0],e[0][1]-r/16*9]),a.push(i=[e[0][0]+t,e[0][1]-r/16*9]),a.push(n),s=[e[0][0]+t/2,e[1][1]],u.push(i),u.push(s),u.push(o),l.push([e[0][0]+t/32*13,e[0][1]-r/16*1]),l.push([e[0][0]+t/32*13,e[0][1]]),l.push([e[0][0]+t/32*19,e[0][1]-r/16*1]),l.push([e[0][0]+t/32*19,e[0][1]]);for(var h=[],c=0;c<3;c++)h[c]=[];return h[0].push(a),h[1].push(l),h[2].push(u),h},samedirectionclosedangle:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=[e[0][0]+t/32*15,e[0][1]],o=[e[0][0],e[0][1]-r/16*13],i=[e[0][0]+t/32*15,e[0][1]-r/16*11],s=[e[0][0]+t/16*15,e[0][1]-r/16*13],a=[];a.push(n),a.push(o),a.push(i),a.push(s),a.push(n);var u=[e[0][0]+t/16,e[0][1]-r/32*27],o=[e[0][0]+t/32*17,e[0][1]-r/16*12],i=[e[0][0]+t,e[0][1]-r/32*27],s=[];s.push([e[0][0]+t/32*17,e[0][1]-r/32*1]),s.push(u),s.push(o),s.push(i);n=[e[0][0]+t/32*14,e[0][1]-r/16*15],u=[e[0][0]+t/32*18,e[0][1]-r],o=[e[0][0]+t/32*18,e[0][1]-r/16*15],i=[];i.push([e[0][0]+t/32*14,e[0][1]-r]),i.push(n),i.push(u),i.push(o);for(var l=[],h=0;h<3;h++)l[h]=[];return l[0].push(a),l[1].push(i),l[2].push(s),l},triangle:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=[];n.push([e[0][0]+t/32*13,e[0][1]-r/16*1]),n.push([e[0][0]+t/32*13,e[0][1]]),n.push([e[0][0]+t/32*19,e[0][1]-r/16*1]),n.push([e[0][0]+t/32*19,e[0][1]]);var o=[];o.push([e[0][0]+t/2,e[0][1]-r/16*2]),o.push([e[0][0],e[0][1]-r/32*17]),o.push([e[0][0]+t/2,e[0][1]-r/32*17]);var i=[];i.push([e[0][0]+t/2,e[0][1]-r/16*2]),i.push([e[0][0]+t,e[0][1]-r/32*17]),i.push([e[0][0]+t/2,e[0][1]-r/32*17]);var s=[];s.push([e[0][0],e[0][1]-r/32*18]),s.push([e[0][0]+t,e[0][1]-r/32*18]);var a=[],u=[e[0][0]+t/2,e[0][1]-r];a.push(u),a.push([e[0][0],e[0][1]-r/32*19]);var l=[e[0][0]+t/2,e[0][1]-r/32*19];a.push(l);e=[e[0][0]+t,e[0][1]-r/32*19],r=[];r.push(l),r.push(e),r.push(u);for(var h=[],c=0;c<6;c++)h[c]=[];return h[0].push(n),h[1].push(o),h[2].push(i),h[3].push(s),h[4].push(a),h[5].push(r),h},vane:function(e){if(null===e||e.length<2)return null;var t=Math.abs(e[1][0]-e[0][0]),r=Math.abs(e[1][1]-e[0][1]),n=null,o=null,i=null,s=null,a=[],u=[];o=[e[0][0],e[0][1]-r/8],i=[e[0][0]+t/2,e[0][1]-r/8*2],s=[e[0][0]+t,e[0][1]-r/8],a.push(n=[e[0][0]+t/2,e[0][1]]),a.push(o),a.push(i),u.push(n),u.push(i),u.push(s),u.push(n);var l=[e[0][0]+t/14*6,e[0][1]-r],h=[e[0][0]+t/28*13,e[0][1]-r/35*34],c=[e[0][0]+t/28*15,e[0][1]-r/35*34],p=[e[0][0]+t/14*8,e[0][1]-r],g=[e[0][0]+t/14*8,e[0][1]-r/8*2],f=[];f.push([e[0][0]+t/14*6,e[0][1]-r/8*2]),f.push(l),f.push(h),f.push(c),f.push(p),f.push(g);var v=[];v.push([e[0][0]+t/14*6,e[0][1]-r/36*21]),v.push([e[0][0]+t/14*2,e[0][1]-r/36*22]),v.push([e[0][0]+t/14*2,e[0][1]-r/36*23]),v.push([e[0][0]+t/14*6,e[0][1]-r/36*22]);var d=[],o=[e[0][0]+t/14*2,e[0][1]-r/36*24],i=[e[0][0]+t/14*2,e[0][1]-r/36*25],s=[e[0][0]+t/14*6,e[0][1]-r/36*24];d.push([e[0][0]+t/14*6,e[0][1]-r/36*23]),d.push(o),d.push(i),d.push(s);n=[],l=[e[0][0]+t/14*2,e[0][1]-r/36*26],h=[e[0][0]+t/14*2,e[0][1]-r/36*27],c=[e[0][0]+t/14*6,e[0][1]-r/36*26];n.push([e[0][0]+t/14*6,e[0][1]-r/36*25]),n.push(l),n.push(h),n.push(c);p=[],g=[e[0][0]+t/14*2,e[0][1]-r/36*28],o=[e[0][0]+t/14*2,e[0][1]-r/36*29],i=[e[0][0]+t/14*6,e[0][1]-r/36*28];p.push([e[0][0]+t/14*6,e[0][1]-r/36*27]),p.push(g),p.push(o),p.push(i);s=[],l=[e[0][0]+t/14*12,e[0][1]-r/36*22],h=[e[0][0]+t/14*12,e[0][1]-r/36*23],c=[e[0][0]+t/14*8,e[0][1]-r/36*22];s.push([e[0][0]+t/14*8,e[0][1]-r/36*21]),s.push(l),s.push(h),s.push(c);g=[],o=[e[0][0]+t/14*12,e[0][1]-r/36*24],i=[e[0][0]+t/14*12,e[0][1]-r/36*25],l=[e[0][0]+t/14*8,e[0][1]-r/36*24];g.push([e[0][0]+t/14*8,e[0][1]-r/36*23]),g.push(o),g.push(i),g.push(l);h=[],c=[e[0][0]+t/14*12,e[0][1]-r/36*26],o=[e[0][0]+t/14*12,e[0][1]-r/36*27],i=[e[0][0]+t/14*8,e[0][1]-r/36*26];h.push([e[0][0]+t/14*8,e[0][1]-r/36*25]),h.push(c),h.push(o),h.push(i);l=[],c=[e[0][0]+t/14*12,e[0][1]-r/36*28],o=[e[0][0]+t/14*12,e[0][1]-r/36*29],i=[e[0][0]+t/14*8,e[0][1]-r/36*28];l.push([e[0][0]+t/14*8,e[0][1]-r/36*27]),l.push(c),l.push(o),l.push(i);for(var y=[],m=0;m<11;m++)y[m]=[];return y[0].push(a),y[1].push(f),y[2].push(v),y[3].push(d),y[4].push(n),y[5].push(p),y[6].push(s),y[7].push(g),y[8].push(h),y[9].push(l),y[10].push(u),y}};function H(e){var t;null===e||e.length<2||(t=[Math.max(e[0][0],e[1][0]),Math.min(e[0][1],e[1][1])],e.splice(0,1,[Math.min(e[0][0],e[1][0]),Math.max(e[0][1],e[1][1])]),e.splice(1,1,t))}function X(e,t){return null!==e?t[0]===e[0]&&t[1]===e[1]||null===t[0]&&null===t[1]&&null===e[0]&&null===e[1]:!1}function Y(e,t,r){var n=2<arguments.length&&void 0!==r?r:new P,o=[];if(null!==e&&2<=e.length)switch(t){case F.SimpleArrow:case F.StraightArrow:o=[function(e,t,r,n,o,i,s,a,u){if(e.length<2)return e;var l=J(e,o,i,s,a),o=l[0],i=l[4],s=K(e,o,i,u,1,1),a=function(e,t,r,n){if(e.length<2)return e;var o=C(e)*t,i=[],s=T(e[1],e[0],1.5*Math.PI,o,!0),t=T(e[1],e[0],1.5*Math.PI,o,!1);if(r){n=T(e[1],e[0],0,o*n,!1);return i.push(s),i.push(n),i.push(t),i}return i.push(s),i.push(t),i}(e,u,t,r),e=a[0],u=a[1],t=3===a.length?a[2]:a[1],r=s.length,a=s.slice(0,Math.ceil(r/2)),r=s.slice(Math.ceil(r/2));a.push(o),r.push(i),a.reverse(),a.push(e),r.reverse(),r.push(t);var h=null,c=null;c="useBezierFit"===n?(h=G(a),G(r)):(h=D(a,2),D(r,2));null!==u&&(h.push(u),c.push(u));h.reverse();for(var p=0;p<l.length;p++)h.push(l[p]);for(var g=0;g<c.length;g++)h.push(c[g]);return h}(e,n.hasSwallowTail,n.swallowTailFactor,n.curveFitMethod,n.headHeightFactor,n.headWidthFactor,n.neckHeightFactor,n.neckWidthFactor,n.tailWidthFactor)];break;case F.DoubleArrow:o=[function(e,t,r,n,o){var i=e.length;if(i<3)return e;var s=null,a=e[0],u=e[1],l=e[2],h=null;3===i?(h=function(e,t,r){var n=null,o=R(e,t),i=x(o,r),t=A(e,o,r),r=0;{if(t<Math.PI/2)return r=i*Math.cos(t),n=T(e,o,1.5*Math.PI,i*Math.sin(t),!1),T(o,n,1.5*Math.PI,r,!0);if(Math.PI/2<=t&&t<Math.PI)return r=i*Math.cos(Math.PI-t),n=T(e,o,1.5*Math.PI,i*Math.sin(Math.PI-t),!1),T(o,n,1.5*Math.PI,r,!1);if(Math.PI<=t&&t<1.5*Math.PI)return r=i*Math.cos(t-Math.PI),n=T(e,o,1.5*Math.PI,i*Math.sin(t-Math.PI),!0),T(o,n,1.5*Math.PI,r,!0)}return r=i*Math.cos(2*Math.PI-t),n=T(e,o,1.5*Math.PI,i*Math.sin(2*Math.PI-t),!0),T(o,n,1.5*Math.PI,r,!1)}(a,u,l),e.push(h)):h=e[3];N(e[0],e[1],e[2])||(a=e[1],u=e[0],l=e[3],h=e[2]);e=R(a,u),h=Q(a,e,h,!0,t,r,n,o),n=Q(e,u,l,!1,t,r,n,o),o=Math.ceil((h.length-5)/2);s=h.slice(0,o);var c=h.slice(o,5+o),p=h.slice(5+o),g=n.slice(0,o),f=n.slice(o,5+o),v=n.slice(5+o);s=G(s);var d=0;for(d=0;d<g.length;d++)p.push(g[d]);var y=G(p);for(v=G(v),d=0;d<c.length;d++)s.push(c[d]);for(d=0;d<y.length;d++)s.push(y[d]);for(d=0;d<f.length;d++)s.push(f[d]);for(d=0;d<v.length;d++)s.push(v[d]);0<s.length&&(X(s[0],s[s.length-1])||s.push(s[0]));return s}(e,n.headHeightFactor,n.headWidthFactor,n.neckHeightFactor,n.neckWidthFactor)];break;case F.SingleLineArrow:o=function(e,t,r){if(e.length<2)return[e];t=function(e,t,r){if(e.length<2)return e;var n=x(e[0],e[1])*t,o=n*r,i=e.length,t=e[i-1],r=x(t,e[i-2]),r=T(e[i-2],t,0,n=r<n?r:n,!1),n=T(t,r,1.5*Math.PI,o,!0),r=T(t,r,1.5*Math.PI,o,!1),o=[];return o.push(n),o.push(t),o.push(r),o}(e,t,r),r=G(e),e=[];return e.push(t),e.push(r),e}(e,n.headHeightFactor,n.headWidthFactor)}return o}function J(e,t,r,n,o){if(e.length<2)return e;var i=C(e)*t,s=i*r,a=i*o,t=e.length,r=[e[t-1][0],e[t-1][1]],o=x(r,e[t-2]),n=(i=o<i?o:i)*n,i=T(e[t-2],r,0,i,!1),e=T(e[t-2],r,0,n,!1),t=T(r,i,1.5*Math.PI,s,!0),n=T(r,e,1.5*Math.PI,a,!0),s=T(r,i,1.5*Math.PI,s,!1),e=T(r,e,1.5*Math.PI,a,!1),a=[];return a.push(n),a.push(t),a.push(r),a.push(s),a.push(e),a}function K(e,t,r,n,o,i){if(e.length<2)return e;for(var s=C(e),a=C(e)*n,u=a-x(t,r)/2,l=0,h=[],c=[],p=1;p<e.length-1;p++){var g=A(e[p-1],e[p],e[p+1])/2,f=(a-(l+=x(e[p-1],e[p]))/s*u)/Math.sin(g);h.push(T(e[p-1],e[p],g,f*o,!0)),c.push(T(e[p-1],e[p],Math.PI-g,f*i,!1))}for(var v=0;v<c.length;v++)h.push(c[v]);return h}function Q(e,t,r,n,o,i,s,a){var u=R(e,t),l=x(u,r),h=T(r,u,0,.3*l,!1),c=T(r,u,0,.5*l,!1),p=T(r,u,0,.7*l,!1),h=T(u,h,1.5*Math.PI,l/4,n),c=T(u,c,1.5*Math.PI,l/4,n),p=T(u,p,1.5*Math.PI,l/4,n),l=[];l.push(u),l.push(h),l.push(c),l.push(p),l.push(r);var g,f=J(l,o,i,s,a),s=f[0],a=f[4],l=K(l,s,a,x(e,t)/C(l)/2,n?.01:1,n?1:.01),n=l.length,v=l.slice(0,Math.ceil(n/2)),d=l.slice(Math.ceil(n/2));for(v.push(s),d.push(a),v.reverse(),v.push(e),d.reverse(),d.push(t),v.reverse(),g=0;g<f.length;g++)v.push(f[g]);for(g=0;g<d.length;g++)v.push(d[g]);return v}function ee(e,t){var r;return t===F.Curve?r=D(e,2):[r=t===F.CustomArea?function(e){var t=null,r=null,n=0,o=null,i=null,s=null,a=null,u=null,l=null,h=null,c=null,p=[],g=[],f=e.length;f<2||e[f-1]===e[f-2]||(n=x(t=e[0],r=e[1]),o=R(t,r),i=T(t,o,1.5*Math.PI,n/4.5,!0),s=T(t,r,0,.8*n,!1),a=T(t,s,1.5*Math.PI,n/5,!1),u=T(t,r,0,.45*n,!1),l=T(t,u,1.5*Math.PI,n/10,!1),h=T(t,r,0,.15*n,!1),c=T(t,h,1.5*Math.PI,n/7,!1),g.push(t,i,r,c,l,a),p=function(e){var t=0,r=0,n=0,o=0,i=0,s=(e=e.slice()).length;e.push(e[0]);var a=[],u=0;for(;u<s;)a.push(R(e[u],e[u+1])),++u;a.push(a[0]),e.push(e[1]);var l=[];u=0;for(;u<s;)t=x(e[u],e[u+1]),r=x(e[u+1],e[u+2]),n=x(a[u],a[u+1]),l.push(T(a[u+1],a[u],0,n*t/(t+r),!1)),++u;var h=[];u=0;for(;u<s;)h.push([a[u][0]+(o=e[u+1][0]-l[u][0]),a[u][1]+(i=e[u+1][1]-l[u][1])]),h.push(e[u+1]),h.push([a[u+1][0]+o,a[u+1][1]+i]),++u;var c=[],p=h.slice();p.push(h[0],h[1]),u=1;for(;u<p.length;)c=c.concat(G(p.slice(u,u+4))),u+=3;return c}(g));return p}(e):r]}function te(e){var t,r,n,o,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],s=2<arguments.length?arguments[2]:void 0,a=[];switch(e){case F.SimpleArrow:case F.StraightArrow:case F.DoubleArrow:case F.SingleLineArrow:a=Y(i,e,s);break;case F.TriangleFlag:case F.RectFlag:case F.CurveFlag:r=e,n=[],o=[],null===(t=i)||t.length<2||(o.push(t[0]),o.push(t[1]),H(t),n=[q[r](o)]),a=n;break;case F.ArrowCross:case F.CircleClosedangle:case F.Closedangle:case F.DoubleClosedangle:case F.Fourstar:case F.Rhombus:case F.SameDirectionClosedangle:case F.Triangle:case F.Vane:a=function(e,t){H(e);var r=[],n=[],o=[],i=[];if(null!==e&&2<=e.length){r.push(e[0]),r.push(e[1]);var s=U[t](r);if(null!==s&&0<s.length){for(var a=0;a<s.length;a++)switch(t){case F.ArrowCross:case F.DoubleClosedangle:case F.CircleClosedangle:case F.Rhombus:case F.SameDirectionClosedangle:(a===s.length-1?o:n).push(s[a][0]);break;case F.Closedangle:case F.Fourstar:(a%2==0?n:o).push(s[a][0]);break;case F.Triangle:(1===a||4===a?o:n).push(s[a][0]);break;case F.Vane:(a===s.length-1?n:o).push(s[a][0])}r=new ol.geom.MultiLineString(n);i.push(r);r=new ol.geom.Polygon(o);i.push(r)}}return i}(i,e);break;case F.CustomArea:case F.Curve:case F.AssemblyArea:a=ee(i,e);break;case F.Circle:a=function(e){var t=e.length;if(null===e||t<2)return[e];var r=e[0];return[r,1e5*x(r,e[t-1])]}(i);break;case F.Rect:a=function(e){if(null===e||e.length<2)return[e];var t=e[0],r=e[1],n=[],o=Math.min(t[0],r[0]),i=Math.max(t[0],r[0]),e=Math.min(t[1],r[1]);return n.push([o,r=Math.max(t[1],r[1])]),n.push([i,r]),n.push([i,e]),n.push([o,e]),n.push([o,r]),[n]}(i);break;case F.Ellipse:a=function(e){if(null===e||e.length<2)return[e];for(var t,r=e[0],n=R(r,e=e[1]),o=Math.abs((r[0]-e[0])/2),i=Math.abs((r[1]-e[1])/2),s=[],a=0;a<=100;a++)s.push([n[0]+o*Math.cos(t=2*Math.PI*a/100),n[1]+i*Math.sin(t)]);return[s]}(i);break;case F.Sector:a=function(e){if(null!==e&&2<e.length){var t=e[0],r=e[1];return[z(t,x(r,t),I(t,r),I(t,e[2]))]}return[e]}(i);break;case F.Polyline:case F.Freehand_line:case F.Marker:case F.Point:a=i;break;case F.Polygon:case F.Freehand_Polygon:null===(n=i)||n.length<2||n.push(n[0]),a=[n]}return a.slice()}function re(e){return new ol.geom.Point(e)}function ne(e){return new ol.geom.LineString(e)}function oe(e){return e=1<e.length?[e]:e,new ol.geom.Polygon(e)}function ie(e){return new ol.geom.Circle(e,(1<arguments.length&&void 0!==arguments[1]?arguments[1]:.1)/1e5)}function se(e){return new ol.geom.GeometryCollection(e)}function ae(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length?arguments[2]:void 0;if(!_(e))return null;if(!y(e))return null;var n,o=te(e=e.toLowerCase(),t,r);switch(e){case F.Point:case F.Marker:n=re(o[0]);break;case F.Polyline:case F.Freehand_line:case F.Curve:n=ne(o);break;case F.Circle:n=ie(o[0],o[1]);break;case F.SingleLineArrow:n=new ol.geom.MultiLineString(o);break;case F.ArrowCross:case F.CircleClosedangle:case F.Closedangle:case F.DoubleClosedangle:case F.Fourstar:case F.Rhombus:case F.SameDirectionClosedangle:case F.Triangle:case F.Vane:n=se(o);break;default:n=oe(o)}return n}var ue={point:re,polyline:ne,linestring:function(e){return new ol.geom.LineString(e)},polygon:oe,geometryCollections:se,circle:ie,multiPoint:function(e){return new ol.geom.MultiPoint(e)},multiPolygon:function(e){return new ol.geom.MultiPolygon(e)},create:ae},le=function(){i(n,ol.geom.Polygon);var r=c(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return m(this,n),(e=r.call(this,t)).setPoints(t),e.fixIndexs=[],e}return s(n,[{key:"isPlot",value:function(){return!0}},{key:"setPoints",value:function(){this.points=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],this.points.length<1||this._update()}},{key:"getPoints",value:function(){return this.points.slice(0)}},{key:"setFixPointsIndex",value:function(){this.fixIndexs=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"getFixPointsIndex",value:function(){return this.fixIndexs}},{key:"getPointCount",value:function(){return this.fixIndexs.slice(0)}},{key:"updatePoint",value:function(e,t){0<=t&&t<this.points.length&&(this.points[t]=e,this._update())}},{key:"updateLastPoint",value:function(e){this.updatePoint(e,this.points.length-1)}},{key:"_update",value:function(){}},{key:"finishDrawing",value:function(){}}]),n}(),he=function(){i(l,le);var r=c(l);function l(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return m(this,l),(e=r.call(this,t)).fixPointCount=3,e.points=t,e}return s(l,[{key:"hasFixed",value:function(){return this.getPointCount()===this.fixPointCount}},{key:"_update",value:function(){this.getPointCount()}},{key:"isPlot",value:function(){return!0}},{key:"_draw",value:function(){var e=this.getStartAngle(),t=this.getEndAngle(),r=$(this.points[0],this._radius,t),n=$(this.points[0],this._radius,e);this.points[2]=n,this.points[3]=r;t=z(this.points[0],this._radius,e,t);this.setCoordinates([t])}},{key:"getPointCount",value:function(){var e=0;if(!this.points[0])return e;for(var t=0;t<this.points.length;t++)_(this.points[t])&&e++;return e}},{key:"modefiy",value:function(e,t){var r;_(e)&&_(t)&&0!==e&&(this.points[e]=t,this._radius=x(this.points[0],this.points[1]),this._azimuthAngle=I(this.points[0],this.points[1]),1<e&&(r=A(this.points[0],this.points[1],t),this._viewAngle=2*(r=r>=Math.PI/2?Math.PI/2:r)),this._viewAngle||(t=this.points[2]||this.points[3])&&(r=A(this.points[0],this.points[1],t),this._viewAngle=2*(r=r>=Math.PI/2?Math.PI/2:r)),2<this.getPointCount()&&this._draw())}},{key:"getStartAngle",value:function(){if(2<this.getPointCount())return Math.PI/2-this._azimuthAngle-this._viewAngle/2}},{key:"getEndAngle",value:function(){if(2<this.getPointCount())return Math.PI/2-this._azimuthAngle+this._viewAngle/2}},{key:"center",get:function(){return this.points[0]}},{key:"bisector",get:function(){return this.points[1]}},{key:"startPoint",get:function(){return this.points[2]}},{key:"endPoint",get:function(){return this.points[2]}},{key:"radius",get:function(){return(1e5*this._radius).toFixed(2)}},{key:"viewAngle",get:function(){return(180*this._viewAngle/Math.PI).toFixed(2)}},{key:"azimuthAngle",get:function(){return(180*this._azimuthAngle/Math.PI).toFixed(2)}}],[{key:"createByGeo",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:60,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:120,n=3<arguments.length?arguments[3]:void 0;if(_(e)){_(n)||(n=2*((u=document.getElementsByClassName("ol-scale-line-inner")[0])?parseInt(u.innerHTML.replace(" km","000")):1e3));var o=j(90-t-r/2),i=j(90-t+r/2),s=j(90-t),a=$(e,n/=1e5,o),u=$(e,n,i),s=$(e,n,s),i=z(e,n,o,i),u=new l([e,s,a,u]);return u.setCoordinates([i]),u._radius=n,u._azimuthAngle=t/180*Math.PI,u._viewAngle=r/180*Math.PI,u}}},{key:"create",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-60,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60,n=3<arguments.length?arguments[3]:void 0;if(_(e)){_(n)||(n=2*((a=document.getElementsByClassName("ol-scale-line-inner")[0])?parseInt(a.innerHTML.replace(" km","000")):1e3));var t=j(t),r=j(r),o=$(e,n/=1e5,t),i=$(e,n,r),s=$(e,n,r-(r-t)/2),a=z(e,n,t,r),i=new l([e,s,o,i]);return i._radius=n,i._viewAngle=Math.abs(r-t),i._azimuthAngle=I(e,s),i.setCoordinates([a]),i}}}]),l}();function ce(e){return new ol.style.Fill({color:0<arguments.length&&void 0!==e?e:[255,255,255,.5]})}function pe(e){if(_(e))return new ol.style.Stroke({color:e.color||[0,153,255,1],width:e.width||2})}function ge(e){e=0<arguments.length&&void 0!==e?e:{};return e.crossOrigin="anonymous",new ol.style.Icon(e)}var fe={getStyle:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e instanceof ol.style.Style?e:new ol.style.Style({image:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.svg;e.src=e.src||e.url;var r=e.src;if(!_(t)&&!_(r))return function(e){var t=e.radius,r=e.fillColor,e=e.stroke,e=void 0===e?{strokeColor:[255,255,255,1],width:1}:e;return new ol.style.Circle({radius:void 0===t?5:t,fill:ce(void 0===r?[0,153,255,1]:r),stroke:pe(e)})}(e);if(t)return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new Image;return t.src="data:image/svg+xml,"+escape(e.svg),e.img=t,ge(e)}(e);return ge(e)}(e.image),fill:ce(e.fill),stroke:pe(e.stroke),text:function(e){if(!_(e))return;e.fill=ce(e.textColor),_(e.stroke)&&(e.stroke=pe(e.stroke));_(e.textBackGroundColor)&&(e.backgroundFill=ce(e.textBackGroundColor));return new ol.style.Text(e)}(e.text),zIndex:e.zIndex})},toString:function(e){if(!(e instanceof ol.style.Style))return{};var t={},r=e.getFill();return _(r)&&(t.fill=r.getColor()),_(r=e.getImage())&&(t.image={scale:r.getScale(),src:r.getSrc()}),_(r=e.getStroke())&&(t.stroke={color:r.getColor(),width:r.getWidth(),dash:r.getLineDash()}),_(r=e.getText())&&(e=r.getStroke(),t.text={font:r.getFont(),offsetX:r.getOffsetX(),offsetY:r.getOffsetY(),padding:r.getPadding(),scale:r.getScale(),text:r.getText(),textAlign:r.getTextAlign(),baseLine:r.getTextBaseline()},_(r.getFill())&&(t.text.textColor=r.getFill().getColor()),_(e)&&(t.text.stroke={color:e.getColor(),width:e.getWidth()}),_(r.getBackgroundFill())&&(t.text.textBackGroundColor=r.getBackgroundFill().getColor())),t}},ve={getFeature:function(e,t,r,n){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};if(!_(e))return null;if(e=e.toLowerCase(),!_(ue[e]))return null;r=ue[e](t,r);return _(r)?(o.geometry=r,o=new ol.Feature(o),_(n)&&o.setStyle(fe.getStyle(n)),o):null},circle:function(e,t,r,n){return ve.getFeature("circle",e,t,n,r)},polyline:function(e,t,r){return ve.getFeature("polyline",e,void 0,r,t)},linestring:function(e,t,r){return ve.getFeature("polyline",e,void 0,r,t)},polygon:function(e,t,r){return ve.getFeature("polygon",e,void 0,r,t)},point:function(e,t,r){return ve.getFeature("point",e,void 0,r,t)},multipoint:function(e,t,r){return ve.getFeature("multipoint",e,void 0,r,t)},multiline:function(e,t,r){return ve.getFeature("multiline",e,void 0,r,t)},multipolygon:function(e,t,r){return ve.getFeature("multipolygon",e,void 0,r,t)}},de=function(){function i(e,t,r,n){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"the_geom";m(this,i),this.serverUrl=e,this.workSpcae=t,this.layerName=n,this.workspaceUri=r,this.typeName=t+":"+n,this.geoName=o}return s(i,null,[{key:"create",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new i(e.serverUrl,e.workspace,e.workspaceUri,e.layerName,e.geoName)}}]),i}();function ye(e,t,r,n){n=(new ol.format.WFS).writeTransaction(e,t,r,{featurePrefix:n.workspace,featureNS:n.workspaceUri,featureType:n.layerName,version:"1.0.0"});return(new XMLSerializer).serializeToString(n)}function me(){return{service:"WFS",request:null,version:"1.0.0",outputformat:"application/json",typename:null,exceptions:"application/json",startIndex:null,maxFeatures:null,cql_filter:null,bbox:null,propertyName:null,sortBy:null}}function we(e,t,r,n,o){o=o||function(e,t){console.log(e,t)};var i=new XMLHttpRequest;i.open(e,t,r),i.setRequestHeader("Content-Type","text/xml"),i.onload=function(){if(200===i.status){var e=i.responseXML,t=e.getElementsByTagName("ServiceExceptionReport"),r=e.getElementsByTagName("wfs:FAILED");return 0<t.length||0<r.length?void o(!1,e):void o(!0)}o(!1,i)},i.send(n)}function _e(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length<=3||void 0===arguments[3]||arguments[3],o=null;return r?(o="("+r+")",n&&(o+=" AND bbox("+t+","+e.join(",")+")")):n&&(o=" bbox("+t+","+e.join(",")+")"),o}function ke(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length?arguments[3]:void 0;_(e)||e instanceof de||console.error("geoConf should be GeoServerConf"),_(o)&&((r=me()).request="GetFeature",r.cql_filter=t,r.typename=e.typeName,n.properties&&n.properties instanceof Array&&(r.propertyName=0<(t=n.properties).length?t.join(","):'("")'),r=f(n,r,!1),r=e.serverUrl+M(r,!0,!0),fetch(r).then(function(e){return e.json()}).then(function(e){_(e.exceptions)?o(!1,e.exceptions):o(!0,e.features)}).catch(function(e){o(!1,e)}))}var Pe={getFeatures:ke,getProperties:function(e,r){if(!(_(e)||e instanceof de))throw"geoConf should be GeoServerConf";var t,n;_(r)&&((t=me()).request="DescribeFeatureType",t.typename=e.typeName,t=e.serverUrl+"?"+function(e){var t,r="";for(t in e)e.hasOwnProperty(t)&&_(e[t])&&(r+=t+"="+e[t]+"&");return r.slice(0,-1)}(t),(n=new XMLHttpRequest).open("Get",t,!0),n.onload=function(){if(200===n.status){var e=JSON.parse(n.responseText);if(_(e.exceptions))return void r(!1,e.exceptions);var t={};return e.featureTypes[0].properties.forEach(function(e){t[e.name]=e.localType}),r(!0,t),void(e=null)}r(!1,n),n=null},n.send())},getBufferGeometry:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60;switch(e){case"point":n=t.getGeometry().getCoordinates(),o=ue.circle(n,r);break;case"polyline":var n=t.getGeometry().getCoordinates(),n=turf.lineString(n),n=turf.buffer(n,r,{units:"meters",steps:64}),o=ue.polygon(n.geometry.coordinates);break;default:o=t.getGeometry()}return o},bufferQuery:function(e,t,r,n,o){if(void 0!==o){if(!(_(n)&&n instanceof ol.geom.Geometry))throw"geom 不能为空，或geom类型不对";n instanceof ol.geom.Circle&&(n=ol.geom.Polygon.fromCircle(n));var i=(new ol.format.WKT).writeGeometry(n),n=e.geoName;t?t+=" AND intersects("+n+","+i+")":t=" intersects("+n+","+i+")",ke(e,t,r,o)}},multiQuery:function(e,t,r,n,o){if(void 0!==o){if(!(n instanceof Array))throw"geoms 参数类型错误";var i=new ol.format.WKT,s=e.geoName,a=[];n.forEach(function(e){e instanceof ol.geom.Circle&&(e=ol.geom.Polygon.fromCircle(e));e=i.writeGeometry(e);a.push(" intersects("+s+","+e+")")});n=" ( "+a.join(" or ")+") ";t?(t+=" AND ",t+=n):t=n,ke(e,t,r,o)}},transaction:function(e,t,r,n,o){if(_(e)&&t){var i,s,a,u=t.geoName,l=t.serverUrl,h=new ol.Feature(n);switch(e){case"insert":_(r)?r.getGeometry()&&(a=r.getGeometry().clone()):a=ue.point([n.lon,n.lat]),h.set(u,a),s=ye([h],null,null,t);break;case"update":s=_(r)?(i=r.getId(),h.setId(i),a=r.getGeometry().clone(),h.set(u,a),h.setGeometryName(u),ye(null,[h],null,t)):null;break;case"delete":s=_(r)?(i=r.getId(),h.setId(i),ye(null,null,[h],t)):null}s&&we("POST",l,!0,s,o)}},batchTransaction:function(e,t,r,n){if(_(e)&&t){for(var o=t.geoName,i=t.serverUrl,s=null,a=[],u=0;u<r.length;u++){var l=r[u],h=l.getGeometry().clone(),c=l.get("properties"),c=new ol.Feature(c);c.set(o,h),c.setGeometryName(o),c.setId(l.getId()),a.push(c)}if(0<a.length){switch(e){case"insert":s=ye(a,null,null,t);break;case"update":s=ye(null,a,null,t);break;case"delete":s=ye(null,null,a,t)}s&&we("POST",i,!0,s,n)}}},batchInsertsFeatures:function(e,t,r){if(_(e)){for(var n=e.geoName,o=e.serverUrl,i=[],s=0;s<t.length;s++){var a=t[s],u=a.getGeometry().clone(),a=a.get("properties"),a=new ol.Feature(a);a.set(n,u),a.setGeometryName(n),i.push(a)}e=ye(i,null,null,e);e&&we("POST",o,!0,e,r)}},batchInsertsJson:function(e,t,r){if(_(e)){for(var n=e.geoName,o=e.serverUrl,i=t.features,s=[],a=0;a<i.length;a++){var u=i[a],l=u.geometry.coordinates,h=u.geometry.type.toLowerCase(),l=ue[h](l),u=new ol.Feature(u.properties);u.set(n,l),s.push(u)}e=ye(s,null,null,e);return e&&we("POST",o,!0,e,r),s}},getDefaultParams:me},Me=function(){i(r,ol.layer.Vector);var t=c(r);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return m(this,r),_(e.source)||(e.source=new ol.source.Vector({wrapX:!1})),(e=t.call(this,e))._custormerProperties=null,e}return s(r,[{key:"source",get:function(){return this.getSource()}},{key:"clear",value:function(){this.getSource().clear()}},{key:"refresh",value:function(){this.getSource().refresh()}},{key:"setLoader",value:function(e){this.getSource().setLoader(e)}},{key:"addFeature",value:function(e){var t;_(e)&&(_(t=e.getId())||(t=v(),e.setId(t)),this.getSource().addFeature(e))}},{key:"addCustomerPropertiesToFeature",value:function(e){this._customerProperties=e;e=this.getFeatures();if(0<e.length){var t,r=o(e);try{for(r.s();!(t=r.n()).done;)t.value.set("custom",this._customerProperties)}catch(e){r.e(e)}finally{r.f()}}}},{key:"getFeatureById",value:function(e){return this.getSource().getFeatureById(e)}},{key:"addFeatures",value:function(e){this.getSource().addFeatures(e)}},{key:"removeFeature",value:function(e){this.getSource().removeFeature(e)}},{key:"removeFeatures",value:function(e){var t=this;e.forEach(function(e){t.removeFeature(e)})}},{key:"removeFeatureById",value:function(e){e=this.getFeatureById(e);_(e)&&(this.removeFeature(e),e=null)}},{key:"getFeatures",value:function(){return this.getSource().getFeatures()}},{key:"loadGeoJson",value:function(e){for(var t,r,n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id",i=arguments.length<=2||void 0===arguments[2]||arguments[2],s=[],a=e.features,u=0;u<a.length;u++)_(a[u].geometry)&&(n=_(o)&&a[u].properties[o]?a[u].properties[o]:a[u].id,_(this.getFeatureById(n))||(r=a[u].geometry.coordinates,t=a[u].geometry.type.toLowerCase(),r=new ol.Feature({geometry:ue[t](r),properties:a[u].properties}),i&&r.set("custom",this._customerProperties),r.setId(n),s.push(r)));s.length<1||this.addFeatures(s),e=a=s=null}}]),r}(),be=function(){i(o,Me);var n=c(o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.geoConf,r=e.queryProperties,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return m(this,o),_(e.source)||(e.source=new ol.source.Vector({wrapX:!1,strategy:ol.loadingstrategy.bbox})),(e=n.call(this,e)).geoConf=t instanceof de?t:de.create(t),e._featureUnique=void 0,e._notDraw=[],e.noCache=!1,e._currentPropertyNames=void 0,e.setQueryProperty(r),e}return s(o,[{key:"geoName",get:function(){return this.geoConf.geoName}},{key:"typeName",get:function(){return this.geoConf.typeName}},{key:"layerName",get:function(){return this.geoConf.layerName}},{key:"setQueryProperty",value:function(e){_(e)&&(~e.indexOf(this.geoName)||e.push(this.geoName),this._currentPropertyNames=e.slice(0))}},{key:"updateFeatures",value:function(){var o=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"id",s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length<=2||void 0===arguments[2]||arguments[2],u=3<arguments.length?arguments[3]:void 0,l=4<arguments.length?arguments[4]:void 0,h=5<arguments.length?arguments[5]:void 0,c=me();c.request="GetFeature",c.typename=this.typeName,_(this._currentPropertyNames)&&(_(this._currentPropertyNames[i])||this._currentPropertyNames.push(i),c.propertyName=this._currentPropertyNames.join(","));var p=this.getSource(),g=this,f=!0;p.setLoader(function(t,e,r){var n;f&&(f=a,c.cql_filter=_e(t,o.geoName,s,a),n=o.geoConf.serverUrl+M(c,!0,o.noCache),u&&u(),fetch(n).then(function(e){return e.json()}).then(function(e){g.loadGeoJson(e,i,!0),l&&l(!0)}).catch(function(e){h&&h(e.message),p.removeLoadedExtent(t),console.error("DynamicLayer",e.message)}))}.bind(this))}},{key:"setUnDraw",value:function(e){if(_(e))return e instanceof Array?this._notDraw.concat(e):~this._notDraw.indexOf(e)||this._notDraw.push(e),e}},{key:"clearUnDraw",value:function(){this._notDraw=[]}},{key:"useCache",value:function(e){this.noCache=e,this.changed()}},{key:"setPreLoaderLisenter",value:function(e){this._preLoaderLisenter=e}},{key:"clear",value:function(){p(h(o.prototype),"clear",this).call(this),this._notDraw=[]}}]),o}(),Se=new ol.style.Style({image:new ol.style.Circle({radius:15,stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({fill:new ol.style.Fill({color:"#fff"})})}),Fe=function(){i(u,be);var a=c(u);function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.geoConf,r=e.queryProperties,n=e.distance,o=void 0===n?10:n,i=e.targetZoom,s=void 0===i?18:i,n=e.type,i=void 0===n?"point":n,n=e.minDistance,e=void 0===n?0:n,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};m(this,u),n.source=new ol.source.Vector({format:new ol.format.GeoJSON,wrapX:!1,strategy:ol.loadingstrategy.bbox}),(n=a.call(this,{geoConf:t,queryProperties:r},n)).sourceType=i;i=new ol.source.Vector;return n._featuresRtree=i.featuresRtree_,n.distance=o,n.targetZoom=s,n.minDistance=e,n.interpolationRatio=0,n._styleCache={},n.features=[],n}return s(u,[{key:"type",set:function(e){this.sourceType=e,this.refresh()}},{key:"clear",value:function(){p(h(u.prototype),"clear",this).call(this),this._featuresRtree.clear()}},{key:"reload",value:function(){var e=this.getSource();e.clear(),e.addFeatures(this.features)}},{key:"updateDistance",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=0===e?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,n&&this.refresh()}},{key:"updateFeatures",value:function(c){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id",t=2<arguments.length?arguments[2]:void 0,p=3<arguments.length?arguments[3]:void 0,g=4<arguments.length?arguments[4]:void 0,r=5<arguments.length?arguments[5]:void 0,n=me();n.request="GetFeature",n.typename=this.typeName,_(this._currentPropertyNames)&&(n.propertyName=this._currentPropertyNames.join(","));var f=this.getSource(),v=this;n.cql_filter=_e(void 0,this.geoName,t,!1),c.on("change",function(){f.refresh()});n=this.geoConf.serverUrl+M(n,!0,!0);this._featureUnique=e,fetch(n).then(function(e){return e.json()}).then(function(e){for(var t=e.features,r=v.layerName,n=ol.extent.createEmpty(),o=[],i=[],s=0,a=t.length;s<a;s++){var u=t[s],l=u.geometry;_(l)&&(b(l=l.coordinates,n),(u=u.properties).layerName=r,u.coordinates=l,i.push(n.slice(0)),o.push(u))}v._featuresRtree.load(i,o);var o=e=null,i=null,h=c.getResolutionForZoom(v.targetZoom);f.setLoader(function(e,t,r){if(v.features=[],p&&p(),h<t)v.cluster(t),v.addFeatures(v.features),v.sourceType="clusterPoint";else{var n=v._featuresRtree.getInExtent(e);v.sourceType="point";for(var o=n.length-1;0<=o;--o)v.features.push(ve.point(n[o].coordinates,n[o]))}v.reload(),g&&g()}.bind(this)),c.changed()}).catch(function(e){r&&r(e.message),console.error("DynamicLayer",e.message)})}},{key:"cluster",value:function(e){if(void 0!==e)for(var t=ol.extent.createEmpty(),r=this.distance*e,n=this._featuresRtree.getAll(),o={},i=0,s=n.length;i<s;i++){var a,u,l=n[i];ol.util.getUid(l)in o||(a=l.coordinates)&&(b(a,t),u=r,(a=l=t)&&(a[0]=l[0]-u,a[1]=l[1]-u,a[2]=l[2]+u,a[3]=l[3]+u),u=this._featuresRtree.getInExtent(t).filter(function(e){e=ol.util.getUid(e);return!(e in o)&&(o[e]=!0)}),this.features.push(this.createCluster(u,t)))}}},{key:"createCluster",value:function(e,t){for(var r,n=[0,0],o=e.length-1;0<=o;--o){var i=e[o].coordinates;i?ol.coordinate.add(n,i):e.splice(o,1)}(r=n)[0]*=s=1/e.length,r[1]*=s;var s=ol.extent.getCenter(t),t=this.interpolationRatio,t=new ol.geom.Point([n[0]*(1-t)+s[0]*t,n[1]*(1-t)+s[1]*t]),t=new ol.Feature(t);return t.set("features",e,!0),1===e.length&&t.setId(e[0][this._featureUnique]),t}},{key:"setStyle",value:function(e){var n=this,o=e;p(h(u.prototype),"setStyle",this).call(this,function(e){if("point"===n.sourceType)return"function"==typeof o?o(e):o;var t=e.get("features")?e.get("features").length:0;if(1<t){var r=n._styleCache[t];return r||((r=(n._culsterStyle?n._culsterStyle():Se).clone()).getText().setText(""+t),n._styleCache[t]=r),r}return"function"==typeof o?o(e.get("features")[0]):o})}},{key:"setClusterStyle",value:function(e){this._culsterStyle="function"!=typeof e?function(){return fe.getStyle(e)}:e}}]),u}();function xe(n,o){for(var e=arguments,i=[],t=2;t<arguments.length;t++)i[t-2]=e[t];return function(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];return n.apply(o,i.concat(Array.prototype.slice.call(t)))}}var Ce=function(){function t(e){m(this,t),this._map=null,this._isInitEvent=!1,this._isRegistered=!1,this.$container=null,this.$chart=null,this.$chartsOptions=e||{},this.$coordSystemId="openlayers_6.2.1"}return s(t,[{key:"appendTo",value:function(e){this.setMap(e)}},{key:"setMap",value:function(e){var t=this;if(!e)throw Error("not ol map object");this._map=e,this._map.once("postrender",function(){t._handleMapChanged()}),this._map.renderSync()}},{key:"getMap",value:function(){return this._map}},{key:"_handleMapChanged",value:function(){var e,t=this.getMap();t&&(this._isInitEvent&&this.$container&&((e=this.$container)&&e.parentNode&&e.parentNode.removeChild(e),this.unBindEvent()),this.$container||this._createLayerContainer(),e=t.getSize(),this.updateViewSize(e),t.getViewport().appendChild(this.$container),this.render(),this.bindEvent(t))}},{key:"render",value:function(){!this.$chart&&this.$container?(this.$chart=echarts.init(this.$container),this._prepareECharts(),this.$chart.setOption(this.$chartsOptions,!1)):this._isVisible()&&this.redraw()}},{key:"clearAndRedraw",value:function(){this.$chart&&this.isVisible()&&(this.$chart.clear(),this.$chart.resize(),this._prepareECharts(),this.$chart.setOption(this.$chartsOptions,!1))}},{key:"redraw",value:function(){this.$chart&&this.isVisible()&&(this.$chart.clear(),this.$chart.resize(),this.$chart.setOption(this.$chartsOptions,!1))}},{key:"bindEvent",value:function(){var e,t=this,r=this.getMap();!r||(e=r.getView())&&(r.on("change:size",function(){return t.onResize()}),e.on("change:resolution",function(){return t.onZoomEnd()},this),e.on("change:center",function(){return t.onCenterChange()},this),e.on("change:rotation",function(){return t.onDragRotateEnd()},this),r.on("movestart",function(){return t.onMoveStart()},this),r.on("moveend",function(){return t.onMoveEnd()},this),this._isInitEvent=!0)}},{key:"unBindEvent",value:function(){var e,t=this.getMap();!t||(e=t.getView())&&(t.un("change:size",this.onResize,this),e.un("change:resolution",this.onZoomEnd,this),e.un("change:center",this.onCenterChange,this),e.un("change:rotation",this.onDragRotateEnd,this),t.un("movestart",this.onMoveStart,this),t.un("moveend",this.onMoveEnd,this),this._initEvent=!1)}},{key:"onResize",value:function(){var e=this.getMap();e&&(e=e.getSize(),this.updateViewSize(e),this.redraw())}},{key:"onZoomEnd",value:function(){this.setVisible(!0);var e=this.getMap();e&&e.getView()&&this.redraw()}},{key:"onCenterChange",value:function(){var e=this.getMap();e&&e.getView()&&this.redraw()}},{key:"onDragRotateEnd",value:function(){this.setVisible(!0);var e=this.getMap();e&&e.getView()&&this.redraw()}},{key:"onMoveStart",value:function(){}},{key:"onMoveEnd",value:function(){this.setVisible(!0);var e=this.getMap();e&&e.getView()&&this.redraw()}},{key:"_prepareECharts",value:function(){if(this.registerMap(),this.$chartsOptions){var e=this.$chartsOptions.series;if(e)for(var t=e.length-1;0<=t;t--)e[t].coordinateSystem=this.$coordSystemId,e[t].animation=!1}}},{key:"registerMap",value:function(){this._isRegistered||(echarts.registerCoordinateSystem(this.$coordSystemId,this._getCoordinateSystem(this.$chartsOptions)),this._isRegistered=!0)}},{key:"_getCoordinateSystem",value:function(){var r=this.$coordSystemId,n=this.getMap(),e=function(){function t(e){m(this,t),this.map=e,this._mapOffset=[0,0],this.dimensions=["x","y"],this.projCode=t.getProjectionCode(this.map)}return s(t,[{key:"getZoom",value:function(){return this.map.getView().getZoom()}},{key:"setZoom",value:function(e){return this.map.getView().setZoom(e)}},{key:"getViewRectAfterRoam",value:function(){return this.getViewRect().clone()}},{key:"setMapOffset",value:function(e){this._mapOffset=e}},{key:"dataToPoint",value:function(e){var t=this.map.getPixelFromCoordinate(e),e=this._mapOffset;return[t[0]-e[0],t[1]-e[1]]}},{key:"pointToData",value:function(e){var t=this._mapOffset;return this.map.getCoordinateFromPixel([e[0]+t[0],e[1]+t[1]])}},{key:"getViewRect",value:function(){var e=this.map.getSize();return new echarts.graphic.BoundingRect(0,0,e[0],e[1])}},{key:"getRoamTransform",value:function(){return echarts.matrix.create()}},{key:"prepareCustoms",value:function(){var e=this.getViewRect();return{coordSys:{type:r,x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:xe(this.dataToPoint,this),size:xe(t.dataToCoordsSize,this)}}}}],[{key:"create",value:function(e){e.eachSeries(function(e){e.get("coordinateSystem")===r&&(e.coordinateSystem=new t(n))})}},{key:"getProjectionCode",value:function(e){return e?e.getView()&&e.getView().getProjection().getCode():"EPSG:3857"}},{key:"dataToCoordsSize",value:function(i,s){var a=this;return void 0===s&&(s=[0,0]),[0,1].map(function(e){var t=s[e],r=[],n=[],o=i[e]/2;r[e]=t-o,n[e]=t+o,r[1-e]=s[1-e],n[1-e]=s[1-e];e=a.dataToPoint(r)[e]-a.dataToPoint(n)[e];return Math.abs(e)},this)}}]),t}();return e.dimensions=e.prototype.dimensions||["x","y"],e}},{key:"_createLayerContainer",value:function(){this.$container=document.createElement("div"),this.$container.style.position="absolute",this.$container.style.top="0px",this.$container.style.left="0px",this.$container.style.right="0px",this.$container.style.bottom="0px",this.$container.style.zIndex=999,this.$container.style.pointerEvents="none"}},{key:"updateViewSize",value:function(e){this.$container&&(this.$container.style.width=e[0]+"px",this.$container.style.height=e[1]+"px")}},{key:"isVisible",value:function(){return this.$container&&"none"!==this.$container.style.display}},{key:"setZIndex",value:function(e){this.$container&&(this.$container.style.zIndex=e="number"==typeof e?""+e:e)}},{key:"getZIndex",value:function(){return this.$container&&this.$container.style.zIndex}},{key:"getChartOptions",value:function(){return this.$chartsOptions}},{key:"setChartOptions",value:function(e){this.$chartsOptions=e=void 0===e?{}:e,this.clearAndRedraw()}},{key:"setVisible",value:function(e){e?(this.$container&&(this.$container.style.display=""),this.clearAndRedraw()):(this.$container&&(this.$container.style.display="none"),this.clear())}},{key:"clear",value:function(){this.$chart&&this.$chart.clear()}},{key:"destroy",value:function(){this.$chart&&(this.$chart.clear(),this.$chart.dispose()),this.unBindEvent()}}]),t}();var Ie={zoomFlashing:function(n,e){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],t=3<arguments.length?arguments[3]:void 0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:500;if(o.length<=0)return null;var s=t.clone(),a=s.getImage();if(!_(a))return null;var u=(new Date).getTime(),l=!0,h=a.getScale();return e.on("postrender",function(e){var t=ol.render.getVectorContext(e),r=e.frameState.time-u,e=r/i,e=l?ol.easing.linear(e)+h:h-ol.easing.linear(e)+1;a.setScale(e),o.forEach(function(e){t.drawFeature(e,s)}),i<r&&(u=(new Date).getTime(),l=!l),n.render()})},showPerHidden:function(r,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],t=3<arguments.length?arguments[3]:void 0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:500;if(n.length<=0)return null;var i=(new Date).getTime(),o=o||500,s=t.clone();return e.on("postrender",function(e){var t=ol.render.getVectorContext(e);(e=e.frameState.time-i)<o?n.forEach(function(e){t.drawFeature(e,s)}):e<2*o||(i=(new Date).getTime()),r.render()})}},Te=function(){i(n,ol.Observable);var r=c(n);function n(e){var t;return m(this,n),(t=r.call(this)).map=e,t._layer=new Me({source:new ol.source.Vector({wrapX:!1}),zIndex:100}),t.map.addLayer(t._layer),t.clickGeometry=null,t.sketchGeometry=null,t._sketchPointFeatures=[],t._defaultStyle=null,t._primitivePoints=[],t._lisenters=[],t._beginMoveEvent=!0,t.arrowParam=void 0,t}return s(n,[{key:"setDrawingStyle",value:function(e){this._layer.setStyle(e)}},{key:"setArrowParam",value:function(e){this.arrowParam=e}},{key:"setMap",value:function(e){this.map=e}},{key:"activate",value:function(n){var o=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.deactivate();var i,s,t,r=function(e){var t=-1;switch(e){case F.TriangleFlag:case F.RectFlag:case F.CurveFlag:case F.ArrowCross:case F.CircleClosedangle:case F.Closedangle:case F.DoubleClosedangle:case F.Fourstar:case F.Rhombus:case F.SameDirectionClosedangle:case F.Triangle:case F.Vane:case F.CustomArea:case F.Circle:case F.Rect:case F.Ellipse:t=2;break;case F.Sector:t=3;break;case F.DoubleArrow:t=4;break;case F.Point:case F.Marker:t=1;break;case F.Polyline:case F.Freehand_line:case F.Polygon:case F.Freehand_Polygon:case F.Curve:case F.SimpleArrow:case F.SingleLineArrow:case F.StraightArrow:t=1/0}return t}(n);-1!==r?(i=e.slice(),s=new ol.Feature,(t=new ol.Feature).setGeometry(this.clickGeometry),this._layer.addFeature(s),this._layer.addFeature(t),e=this.map.on("singleclick",function(e){var t=e.coordinate;o.clickGeometry.setCoordinates(t),i.push(t),o.sketchGeometry=ue.create(n,i.slice(),o.arrowParam),s.setGeometry(o.sketchGeometry),i.length===r?(o.dispatchEvent({type:k.DRAW_END,feature:s,coordinate:i.slice()}),o.deactivate()):o.dispatchEvent({type:k.DRAWING,feature:s,coordinates:t}),e.preventDefault()}),t=this.map.on("dblclick",function(e){i.push(e.coordinate),o.sketchGeometry=ue.create(n,i.slice(),o.arrowParam),s.setGeometry(o.sketchGeometry),o.dispatchEvent({type:k.DRAW_END,feature:s,coordinate:i.slice()}),o.deactivate(),e.preventDefault(),e.stopPropagation()}),this._lisenters.push(t),t=this.map.on("pointermove",function(e){var t,r=e.coordinate;null===o.clickGeometry?o.clickGeometry=ue.point(r):o.clickGeometry.setCoordinates(r),i.push(r),o.sketchGeometry=ue.create(n,i.slice(),o.arrowParam),s.setGeometry(o.sketchGeometry),(t=n)!==F.Freehand_line&&t!==F.Freehand_Polygon&&i.pop(),o.dispatchEvent({type:k.MOVEING,feature:s,coordinate:r}),e.preventDefault()}),this._lisenters.push(t),this._lisenters.push(e)):console.log("".concat(n," 类型暂时不支持绘制"))}},{key:"deactivate",value:function(){this._layer.clear(),this.sketchGeometry=null,this._sketchPointFeatures=[],this._primitivePoints=[],this._lisenters.forEach(function(e){ol.Observable.unByKey(e)})}}]),n}(),Ae={createImageLayer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!_(e.type))return null;var t,r=e.type.toLowerCase(),n=e.source||{};return n.wrapX=!1,n.serverType="geoserver",n.url=e.url,delete e.type,delete e.url,delete e.source,"tile"==r?(n.crossOrigin="anonymous",e.source=new ol.source.TileWMS(n),t=new ol.layer.Tile(e)):"image"==r?(n.crossOrigin="anonymous",e.source=new ol.source.ImageWMS(n),t=new ol.layer.Image(e)):"xyz"==r&&(e.source=new ol.source.XYZ(n),t=new ol.layer.Tile(e)),t},createXYZTileLayer:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.format,n=void 0===r?"png":r,o=t.name,i=t.isGoogle,s=t.cacheSize,a=void 0===s?256:s,u=t.maxZoom,l=void 0===u?21:u,r=t.projection,s=void 0===r?"epsg:4326":r,u=t.extent,r=t.maxResolution,t=t.minResolution;if(null!=e)return o&&(e+=o),"/"==(""+e).substring(e.length-1,e.length)&&(e=(""+e).slice(0,-1)),new ol.layer.Tile({source:new ol.source.XYZ({crossOrigin:"anonymous",wrapX:!1,maxZoom:l,cacheSize:a,url:e+((i?"/{z}/{x}/{y}.":"/{z}/{x}/{-y}.")+n),projection:s}),extent:u,maxResolution:r,minResolution:t});console.error("url 为必须参数")},updateWMSLayer:function(e,t){var r;e instanceof ol.layer.Tile&&(null!=(r=e.getSource())&&(e=r.getParams(),null!=t&&(e=f(t,e)),r.updateParams(e)))},createWMSImageLayer:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.styles,n=t.format,o=t.maxResolution,i=void 0===o?void 0:o,o=t.minResolution,o=void 0===o?void 0:o;return new ol.layer.Image({source:new ol.source.ImageWMS({crossOrigin:"anonymous",wrapX:!1,serverType:"geoserver",url:e,params:{FORMAT:void 0===n?"image/png":n,tiled:!0,STYLES:void 0===r?null:r,LAYERS:t.layers,transparent:"true"}}),maxResolution:i,minResolution:o})},createWMSTileLayer:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.format,n=t.projection,o=void 0===n?"EPSG:4326":n,i=t.maxResolution,n=void 0===i?void 0:i,i=t.minResolution,i=void 0===i?void 0:i;return new ol.layer.Tile({source:new ol.source.TileWMS({crossOrigin:"anonymous",wrapX:!1,url:e,params:{FORMAT:void 0===r?"image/png":r,TILED:!0,LAYERS:t.layers,TRANSPARENT:"true"}}),projection:o,maxResolution:n,minResolution:i})},fromGeoJson:function(e,t){var r=t.getSource(),n=JSON.parse(e),o=0;if(0<n.LineFeature.length)for(o=0;o<n.LineFeature.length;o++){for(var i,s=[],a=0;a<n.LineFeature[o].coordinates.length;a++)a%2==0&&((i=[]).push(n.LineFeature[o].coordinates[a]),i.push(n.LineFeature[o].coordinates[a+1]),s.push(i));var u=new ol.Feature({geometry:new ol.geom.LineString(s)});u.setStyle(fe.getStyle(n.LineFeature.style)),u.set("properties",n.LineFeature[o].properties),r.addFeature(u)}if(0<n.MarkPoint.length)for(o=0;o<n.MarkPoint.length;o++){var l=new ol.Feature({geometry:new ol.geom.Point([n.MarkPoint[o].coordinates[0],n.MarkPoint[o].coordinates[1]])});l.setId(n.MarkPoint[o].id),l.setStyle(fe.getStyle(n.MarkPoint[o].style)),l.set("properties",n.MarkPoint[o].properties),r.addFeature(l)}if(0<n.MistdFeature.length)for(var h=0;h<n.MistdFeature.length;h++){var c=n.MistdFeature[h].name,p=ae(c,n.MistdFeature[h].vertices),p=new ol.Feature(p);p.name=c,p.setId(n.MistdFeature[h].id),p.setStyle(fe.getStyle(n.MistdFeature[h].style)),p.set("properties",n.MistdFeature[h].properties),r.addFeature(p)}},toGeoJson:function(e){for(var t={MarkPoint:[],MistdFeature:[],GeometryFeature:[],LineFeature:[]},r=e.getSource().getFeatures(),n=0;n<r.length;n++){var o={};if(o.style=fe.toString(r[n].getStyle()),o.properties=r[n].get("properties")||{},o.id=r[n].getId(),_(r[n].name))null!==r[n].get("geometry").milStdType&&""!==r[n].get("geometry").milStdType?o.name=r[n].get("geometry").milStdType:o.name=r[n].name,null!==r[n].get("geometry").vertices&&""!==r[n].get("geometry").vertices?o.vertices=r[n].get("geometry").vertices:o.vertices=r[n].vertices,o.style=fe.toString(r[n].getStyle()),t.MistdFeature.push(o);else if("Point"===r[n].get("geometry").getType()){if(null!==r[n].getStyle().getImage()){for(var i=r[n].getStyle().getImage().getSrc().split("/"),s="",a=3;a<i.length;a++)3===a||(s+="/"),s+=i[a];o.imageUrl=s,o.coordinates=r[n].get("geometry").getExtent(),o.style=[],r[n].getStyle().getText()?o.label=r[n].getStyle().getText().getText():o.label=""}else o.imageUrl="",o.coordinates=r[n].get("geometry").getExtent(),o.style=[],r[n].getStyle().getText()?o.label=r[n].getStyle().getText().getText():o.label="";o.style=fe.toString(r[n].getStyle()),t.MarkPoint.push(o)}else"LineString"===r[n].get("geometry").getType()&&(o.coordinates=r[n].get("geometry").getCoordinates(),o.style=fe.toString(r[n].getStyle()),t.LineFeature.push(o))}return JSON.stringify(t)}},Ee=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2})}),Oe=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:3,stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 1)",width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 1)"})})}),Le=function(){function c(e){m(this,c),this.map=e,this._layer=new Me,this.map.addLayer(this._layer),this._listeners=[],this._overlays=[],this._tipBg="background-color: red;"}return s(c,[{key:"setTipBg",value:function(e){this._tipBg=e}},{key:"getLayer",value:function(){return this._layer}},{key:"clear",value:function(){var t=this.map;this._overlays.forEach(function(e){t.removeOverlay(e)}),this._layer.clear(),this.beforeMeasure(),this._overlays=[]}},{key:"measureArea",value:function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ee,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Oe,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e-4;this.beforeMeasure();var s=this,a=[],u=ve.getFeature("polygon",[]);u.setStyle(e),this._layer.setStyle(o),this._layer.addFeature(u);var l=Re("area");this.map.addOverlay(l.overlay),this._overlays.push(l.overlay);e=this.map.on("singleclick",function(e){var t=e.coordinate,r=ve.getFeature("point",t);s._layer.addFeature(r),a.push(t),1===a.length&&(t=s.map.on("pointermove",function(e){var t=e.coordinate;x(t,a[a.length-1])<i||((e=a.slice(0)).push(t),u.getGeometry().setCoordinates([e]),(e=u.getGeometry().getExtent())&&(l.overlay.setPosition([(e[0]+e[2])/2,(e[1]+e[3])/2]),l.span.innerText=c.getArea(s.map,u.getGeometry())))}),s._listeners.push(t)),e.preventDefault()});s._listeners.push(e),this.map.once("dblclick",function(e){s.beforeMeasure();var t=e.coordinate,r=ve.getFeature("point",t);s._layer.addFeature(r),a.push(t),a.push(a[0]),u.getGeometry().setCoordinates([a]),u.setStyle(o),e.preventDefault(),n&&n(u)})}},{key:"measureLength",value:function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ee,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Oe,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1e-4;this.beforeMeasure();var i=this,s=[],a=ve.getFeature("polyline",[]);a.setStyle(e);var u=ve.getFeature("polyline",[]);this._layer.addFeature(a),this._layer.addFeature(u),this._layer.setStyle(t);var l,h=Re("length");this.map.addOverlay(h.overlay),this._overlays.push(h.overlay);t=this.map.on("click",function(e){var t,r=e.coordinate,n=ve.getFeature("point",r);i._layer.addFeature(n),s.push(r),a.getGeometry().setCoordinates([]),u.getGeometry().setCoordinates(s.slice(0)),1===s.length?(t=i.map.on("pointermove",function(e){var t=e.coordinate,e=s[s.length-1];x(t,e)<o||(l=[e,t],a.getGeometry().setCoordinates(l.slice(0)),h.overlay.setPosition(t),h.span.innerText=c.getLength(i.map,a.getGeometry()))}),i._listeners.push(t)):((t=function(e){var t='<label style="cursor:pointer;position: absolute;white-space: nowrap;display: inline;border: none;padding: 0px;font-size: 12px;color: rgba(51,51,51);background-color: white;"><span class="childLength" style="position: absolute;padding: 0 4px 1px 5px;color: rgb(151,151,151);line-height: 17px;'+e+'left: 5px;"></span></label>',e=document.createElement("div");e.innerHTML=t;t=e.getElementsByClassName("childLength")[0];return{overlay:new ol.Overlay({element:e,offset:[5,5],positioning:"bottom-center",stopEvent:!1}),span:t}}(i._tipBg)).overlay.setPosition(r),t.span.innerText=c.getLength(i.map,u.getGeometry())+"公里",i.map.addOverlay(t.overlay),i._overlays.push(t.overlay)),e.preventDefault()});i._listeners.push(t),this.map.once("dblclick",function(e){i._layer.removeFeature(a),i.beforeMeasure();var t=e.coordinate,r=ve.getFeature("point",t);i._layer.addFeature(r),s.push(t),h.overlay.setPosition(t),u.getGeometry().setCoordinates(s.slice(0)),h.span.innerText=c.getLength(i.map,u.getGeometry()),s=[],i.map.getTargetElement().style.cursor="default",e.preventDefault(),n&&n(u)})}},{key:"beforeMeasure",value:function(){this._listeners.forEach(function(e){ol.Observable.unByKey(e)}),this._listeners=[]}},{key:"setMeasuringStyle",value:function(e){e&&this._layer.setStyle(e)}}],[{key:"getArea",value:function(e,t){e=e.view.getProjection(),e=t.clone().transform(e,"EPSG:4326"),e=ol.sphere.getArea(e,{projection:"EPSG:4326",radius:6378137});return Math.round(e/1e6*100)/100}},{key:"getDistance",value:function(e,t){for(var r,n,o=0,i=e.view.getProjection(),s=0,a=t.length-1;s<a;++s)r=ol.proj.transform(t[s],i,"EPSG:4326"),n=ol.proj.transform(t[s+1],i,"EPSG:4326"),o+=ol.sphere.getDistance(r,n,{projection:"EPSG:4326",radius:6378137});return Math.round(o/1e3*1e3)/1e3}},{key:"getLength",value:function(e,t){e=e.view.getProjection(),e=t.clone().transform(e,"EPSG:4326"),e=ol.sphere.getLength(e,{projection:"EPSG:4326",radius:6378137});return Math.round(e/1e3*1e3)/1e3}}]),c}();function Re(e){var t="",r="",r="length"===e?(t="总长: "," 公里"):(t="总面积: "," 平方公里"),t='<label style="position: absolute;display: inline;background-color: white;border: 1px solid rgb(255,1,3);padding: 3px 5px;white-space: nowrap;font-size: 12px;line-height: 16px;color: rgb(51, 51, 51);max-width: fit-content;">'+t+'<span style="color: #ff6319;font-weight: 700;line-height: 16px;white-space: nowrap;font-size: 12px;">0.0</span>'+r+"</label>",r=document.createElement("div");r.innerHTML=t;t=r.getElementsByTagName("span")[0];return{overlay:new ol.Overlay({element:r,offset:[5,5],positioning:"bottom-center",stopEvent:!1}),span:t}}var Ge=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.type,n=void 0===r?"trackFeature":r,o=t.showArrow,r=void 0===o||o,o=t.showMarker,o=void 0===o||o,t=t.showPath,t=void 0===t||t;m(this,i),this.positions=e.slice(0),this.type=n,this._showArrow=r,this._showMarker=o,this._showRoutes=t,this._endPoints=[],this._arrows=[],this._routes=[],this._layer=null,this._visible=!1,this._arrowSize=null,this._arrowInterval=80,this._arrowIconScale=1,this._routWidth=6,this._dynamicArrows=!0,this._arrowStyleLisenter=null,this._arrowIcon=this.setArrowIcon(),this._arrowRotations=[],this._routeGeom=new ol.geom.LineString(this.positions),this._routeOutside=new ol.Feature({type:this.type,geometry:this._routeGeom.clone()}),this._routInside=new ol.Feature({type:this.type,geometry:this._routeGeom.clone()}),this._routes.push(this._routeOutside),this._routes.push(this._routInside),this._init()}return s(i,[{key:"arrowInterval",get:function(){return this._arrowInterval},set:function(e){_(e)&&(this._arrowInterval=e)}},{key:"dynamicArrow",set:function(e){this._dynamicArrows=e}},{key:"setArrowIcon",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:24,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"white",r=document.createElement("canvas");r.width=e,r.height=e;var n=r.getContext("2d");n.strokeStyle=t,n.lineJoin="round",n.lineWidth=8,n.moveTo(-4,e-4),n.lineTo(e/2,6),n.lineTo(e+4,e-4),n.stroke(),this._arrowSize=e,this._arrowIcon=r}},{key:"setRouteStyle",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.border,r=void 0===t?"#FFE4B5":t,n=e.fill,o=void 0===n?"#00EEEE":n,i=e.width,t=void 0===i?6:i,n=e.offset,i=void 0===n?4:n,e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0;_(t)&&(this._routWidth=t);i=new ol.style.Style({stroke:new ol.style.Stroke({color:r,width:this._routWidth+i})}),o=new ol.style.Style({stroke:new ol.style.Stroke({color:o,width:this._routWidth})});this._routeOutside.setStyle(i),this._routInside.setStyle(o),this.setArrowIcon(n,e),this._arrowIconScale=this._routWidth/this._arrowSize}},{key:"_init",value:function(){for(var e=this.positions.length,t=0;t<e-1;t++){var r=this.positions[t],n=this.positions[t+1];this._endPoints.push(new ol.Feature({geometry:new ol.geom.Point(r)})),this._arrowRotations.push(Math.atan2(n[1]-r[1],n[0]-r[0]))}this._endPoints.push(new ol.Feature({type:this.type,geometry:new ol.geom.Point(this.positions[e-1])}))}},{key:"updateArrow",value:function(e){var t=this;if(!this._arrowStyleLisenter){var r=e.view;return this._arrowStyleLisenter=r.on("change:resolution",function(){return t.drawArrow(e)}),e.once("rendercomplete",function(){return t.drawArrow(e)}),this._arrowStyleLisenter}}},{key:"drawArrow",value:function(e){if(_(this._layer)){this._layer.removeFeatures(this._arrows),this._arrows=[];for(var t=function(e,t,r){for(var n=[],o=0;o<t.length-1;o++){var i=e.getPixelFromCoordinate(t[o]),s=e.getPixelFromCoordinate(t[o+1]),a=[s[0]-i[0],s[1]-i[1]],s=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)),u=[a[0]/s,a[1]/s],l=Math.floor(s/r),h=[];if(l>0)for(var c=1;c<=l;c++)h.push(e.getCoordinateFromPixel([Math.round(u[0]*c*r+i[0]),Math.round(u[1]*c*r+i[1])]));else h.push([(t[o][0]+t[o+1][0])/2,(t[o][1]+t[o+1][1])/2]);n.push(h)}return n}(e,this.positions,this._arrowInterval),r=0;r<t.length;r++){var n=new ol.Feature({geometry:new ol.geom.MultiPoint(t[r])}),o=new ol.style.Style({zIndex:1e5,image:new ol.style.Icon({imgSize:[this._arrowSize,this._arrowSize],img:this._arrowIcon,rotateWithView:!0,rotation:Math.PI/2-this._arrowRotations[r],scale:this._arrowIconScale})});n.setStyle(o),this._arrows.push(n)}this._layer.addFeatures(this._arrows)}}},{key:"setMarkerStyle",value:function(e,t){if(0<=t&&t<this._endPoints.length){t=this._endPoints[t];return t.setStyle(e),[t]}}},{key:"setLayer",value:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1];this._layer=e,(this._visible=t)&&(this._showRoutes&&e.addFeatures(this._routes),this._showArrow&&e.addFeatures(this._arrows),this._showMarker&&e.addFeatures(this._endPoints))}},{key:"getPoints",value:function(){return this.positions.slice(0)}},{key:"getFeatures",value:function(){var e={};return e.arrows=this._arrows,e.markers=this._endPoints,e.routes=this._routes,e}},{key:"setVisible",value:function(e){this._visible=e,this.showRoutes(e),this.showMarkers(e),this.showArrows(e)}},{key:"showArrows",value:function(e){this._showArrow!==e&&(this._showArrow=e,De(this._layer,e,this._arrows))}},{key:"showMarkers",value:function(e){this._showMarker!==e&&(this._showMarker=e,De(this._layer,e,this._endPoints))}},{key:"showRoutes",value:function(e){this._showRoutes!==e&&(this._showRoutes=e,De(this._layer,e,this._routes))}},{key:"destroy",value:function(){this.setVisible(!1),this._arrows=[],this._endPoints=[],this._routes=[]}}]),i}();function De(e,t,r){_(e)&&(t?e.addFeatures(r):e.removeFeatures(r))}e.Animation=Ie,e.ArrowParams=P,e.AssociativeArray=t,e.Constants=u,e.Draw=Te,e.DynamicLayer=Fe,e.EchartsLayer=Ce,e.Event=k,e.FeatureFactory=ve,e.GeoServer=Pe,e.GeoServerConf=de,e.Geometry=ue,e.GeometryHelper=te,e.GeometryType=F,e.IbaseGeometry=le,e.Layer=Ae,e.Map=d,e.Math=Z,e.Measure=Le,e.SectorGeometry=he,e.StyleUtil=fe,e.TrackFeature=Ge,e.VERSION="1.0.0",e.VectorLayer=Me,e.WFSLayer=be,e.combine=f,e.common=S,e.createGuid=v,e.defaultValue=g,e.defined=_,Object.defineProperty(e,"__esModule",{value:!0})});
